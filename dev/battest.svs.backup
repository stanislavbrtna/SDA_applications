 # Simple app for measuring how long the SDA can go on battery

function init {
	scr = sys pAddScreen();
	sys pSetMainScr(scr);

  text = sys pAddText(0, 0, 8, 1, "Battery tester!", scr);
	btn1 = sys pAddButton(1, 1, 5, 2, "Start", scr);
	time = 0;

	sys cOpen("battest.dat");
	sys pAddText(0, 4, 8, 5, "Last time: "+num(sys cKeyRead("time"))/60+" : "+num(sys cKeyRead("time"))%60, scr);
	sys cClose();
}

function update {
	if (sys pGetEventC(btn1) == EV_RELEASED) {
		running = 1;
		sys sleepLock(1);
	}

	if (running == 1) {
	  sys sxSetArea(0, 64, 318, 300);
	  sys sxClearArea(sys sxMixColor(255,0,0));

	  for(x = 0; x < 320; x++;) {
		  for(y = 0; y < 250; y++;) {
		  sys sxFillRect(x , y, x, y, sys rnd());
		  check();
		  }
	  }
	}
}

function check{
	min = sys getTimeMin();
	if (min != oldmin) {
		time++;
		sys cOpen("battest.dat");
		sys cKeyWrite("time", "" + time);
		sys cClose();
		sys pSetStr(text, "time: " + time/60 + " : " + time%60);
	}
	oldmin = min;
}
